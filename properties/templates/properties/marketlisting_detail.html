{% extends "base.html" %}
{% load static %}

{% block title %}{{ listing.title|default:listing.address }} – 123woningruilen.nl{% endblock %}
{% block description %}{{ listing.description|truncatewords:25|default:"Woningruil, huur en koop – eenvoudig geregeld" }}{% endblock %}
{% block og_title %}{{ listing.title|default:listing.address }}{% endblock %}
{% block og_description %}{{ listing.description|truncatewords:25|default:"Woningruil, huur en koop – eenvoudig geregeld" }}{% endblock %}
{% block og_image %}{{ request.build_absolute_uri }}{{ listing.cover_url }}{% endblock %}

{% block content %}
<main class="container my-4">

  <!-- Hero sectie -->
  <div class="woning-hero">
    <!-- Coverfoto -->
    <a href="{{ listing.cover_url }}" class="glightbox" data-gallery="woning">
      <img src="{{ listing.cover_url }}" alt="{{ listing.title }}"
           class="hoofdfoto"
           style="width:100%;max-height:500px;object-fit:cover;border-radius:6px;">
    </a>

    <!-- Thumbnails -->
    {% if listing.images.all %}
      <div class="thumbnails mt-2 d-flex gap-2 flex-wrap">
        {% for im in listing.images.all %}
          <a href="{{ im.image.url }}" class="glightbox" data-gallery="woning">
            <img src="{{ im.image.url }}" alt="foto {{ forloop.counter }}"
                 class="thumb"
                 style="width:100px;height:70px;object-fit:cover;border-radius:4px;">
          </a>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <!-- Call to Action -->
  <div class="cta-buttons my-3">
    <a href="#" class="btn btn-primary">Plan een bezichtiging</a>
    <a href="https://wa.me/{{ listing.contact_number|default:'' }}" class="btn btn-outline-secondary">Stuur bericht</a>
  </div>

  <!-- Basisinformatie -->
  <header class="woning-header my-4">
    <h1>{{ listing.title|default:listing.address }}</h1>
    <p class="sub-info">
      {{ listing.address }}, {{ listing.postcode }} {{ listing.city }}
      · {{ listing.living_area }} m²
      · {{ listing.rooms }} kamers
    </p>
  </header>

  <!-- Omschrijving -->
  <section class="woning-beschrijving my-4">
    <h2>Omschrijving</h2>
    <p>{{ listing.description|linebreaks }}</p>
  </section>

  <!-- Kenmerken -->
  <section class="kenmerken my-4">
    <h2>Kenmerken</h2>
    <dl>
      <dt>Oppervlakte</dt><dd>{{ listing.living_area }} m²</dd>
      <dt>Kamers</dt><dd>{{ listing.rooms }}</dd>
      {% if listing.energy_label %}<dt>Energielabel</dt><dd>{{ listing.energy_label }}</dd>{% endif %}
      <dt>Prijs</dt><dd>€ {{ listing.price }}</dd>
    </dl>
  </section>

  <!-- Locatie -->
  <section class="woning-locatie my-4">
    <h2>Locatie</h2>
    <div id="map" style="height:300px; background:#eee; border-radius:6px;"></div>
  </section>

</main>

<!-- Lightbox -->
<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
<script>
  const lightbox = GLightbox({
    selector: ".glightbox",
    touchNavigation: true,
    loop: true,
    zoomable: true,
    closeButton: true
  });
</script>
{% endblock %}
